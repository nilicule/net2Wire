<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NET2WIRE</title>
    <!-- Modular CSS files -->
    <link rel="stylesheet" href="{{ base_path }}/static/css/base.css">
    <link rel="stylesheet" href="{{ base_path }}/static/css/layout.css">
    <link rel="stylesheet" href="{{ base_path }}/static/css/canvas.css">
    <link rel="stylesheet" href="{{ base_path }}/static/css/shapes.css">
    <link rel="stylesheet" href="{{ base_path }}/static/css/ui.css">
    <link rel="stylesheet" href="{{ base_path }}/static/css/collaboration.css">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <span class="logo">NET2WIRE - Collaborative wireframe tool</span>
        </div>
        <div class="header-right" style="position: relative;">
            <!-- Compact users indicator -->
            <div class="users-indicator" id="users-indicator" style="display: none;">
                <span class="users-icon">üë•</span>
                <span class="users-count" id="user-count">0</span>
                <!-- Expanded users list on hover -->
                <div class="users-dropdown" id="users-dropdown">
                    <div class="users-dropdown-header">Online Users</div>
                    <div id="users-container"></div>
                </div>
            </div>
            <button class="chat-btn" id="chat-btn">üí¨ Chat</button>
            <button class="share-btn" id="share-btn">üîó Share</button>
            <button class="menu-btn" id="menu-btn">‚ò∞</button>
            <div class="menu-dropdown" id="menu-dropdown">
                <button class="menu-item" onclick="saveWireframe()">üíæ Save</button>
                <button class="menu-item" onclick="document.getElementById('load-input').click()">üìÅ Load</button>
                <button class="menu-item" onclick="clearCanvas()">üóëÔ∏è Clear</button>
            </div>
            <input type="file" id="load-input" class="file-input" accept=".json" onchange="loadWireframe(event)">
        </div>
    </div>
    
    
    <div class="canvas-area">
        <div class="browser-bar">
            <div class="browser-dots">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
            </div>
        </div>
        <div class="canvas" id="canvas"></div>
        <div class="position-info" id="position-info">X: 0 px &nbsp;&nbsp; Y: 0 px &nbsp;&nbsp; W: 0 px &nbsp;&nbsp; H: 0 px</div>
    </div>

    <!-- Chat UI -->
    <div class="chat-container" id="chat-container" style="display: none;">
        <div class="chat-header">
            <span>üí¨ Chat</span>
            <button class="chat-close" id="chat-close">√ó</button>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chat-input" placeholder="Type a message..." maxlength="500">
            <button class="chat-send-btn" id="chat-send-btn">Send</button>
        </div>
    </div>

    <!-- Import Socket.IO - compatible with Flask-SocketIO 5.3+ -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Set global configuration -->
    <script>
        // Make room configuration globally available
        window.ROOM_ID = '{{ room_id }}';
        window.IS_NEW_ROOM = {{ 'true' if is_new_room else 'false' }};
        window.BASE_PATH = '{{ base_path }}';
        console.log('Room configuration:', { 
            ROOM_ID: window.ROOM_ID, 
            IS_NEW_ROOM: window.IS_NEW_ROOM,
            BASE_PATH: window.BASE_PATH,
            currentPath: window.location.pathname 
        });
    </script>
    
    <!-- Import modular JavaScript files -->
    <script type="module">
        import { initializeCanvas } from '{{ base_path }}/static/js/canvas.js';
        import { initializeCollaboration, startMouseTracking, initializeChatHandlers } from '{{ base_path }}/static/js/collaboration.js';
        import { initializeUI } from '{{ base_path }}/static/js/ui.js';
        
        // Initialize all modules when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCanvas();
            initializeCollaboration(window.ROOM_ID, window.IS_NEW_ROOM);
            startMouseTracking();
            initializeUI(window.ROOM_ID);
            initializeChatHandlers();
        });
    </script>
</body>
</html>